// Generated by CoffeeScript 1.3.3
var Event, event;

Event = (function() {

  function Event() {}

  Event.page;

  Event.prototype._setField = function(targetElement, value) {
    return targetElement.append(value);
  };

  Event.prototype._resetLayout = function() {
    return $('[data-is-event-field=1]', this.page).each(function() {
      var eventElement;
      eventElement = $(this);
      if (eventElement.find('.tpl').length) {
        return eventElement.children(':not(.tpl)').remove();
      } else {
        return eventElement.html('');
      }
    });
  };

  Event.prototype.initialize = function(eventNode, options) {
    var childField, childFieldRound, children, eventField, eventText, fieldName, liTpl, targetElement, _i, _j, _k, _len, _len1, _len2, _liTpl, _liTplLink, _ref, _ref1, _ref2;
    this.page = $('#event');
    this._resetLayout();
    _ref = eventNode.children();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      eventField = _ref[_i];
      fieldName = eventField.tagName;
      eventField = $(eventField);
      targetElement = $("#event-" + fieldName);
      eventText = '';
      children = eventField.children();
      if (fieldName !== 'links') {
        if (children.length > 1) {
          childFieldRound = 0;
          _ref1 = eventField.children();
          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
            childField = _ref1[_j];
            childFieldRound++;
            if (childFieldRound > 1) {
              eventText += ', ';
            }
            eventText += $(childField).text();
          }
        } else {
          eventText = eventField.text();
        }
      } else {
        liTpl = targetElement.find('li:first').clone().show();
        _ref2 = eventField.children();
        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
          childField = _ref2[_k];
          childField = $(childField);
          _liTpl = liTpl.clone();
          _liTpl.removeClass('tpl');
          _liTplLink = _liTpl.find('a:first');
          _liTplLink.html(childField.text());
          _liTplLink.attr('href', childField.attr('href'));
          eventText += $('<div/>').append(_liTpl).html();
        }
      }
      this._setField(targetElement, eventText);
    }
    return $.mobile.changePage(this.page, {
      transition: 'flow'
    });
  };

  return Event;

})();

event = new Event();
